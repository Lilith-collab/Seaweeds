---
title: "Seaweeds"
author: "Lilith Diener"
date: "2025-03-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 

Firstly, we install and load all necessary packages

```{r}

# Install packages
install.packages("ggmap")
install.packages("ggmap", dependencies = TRUE)
install.packages("ggspatial")
install.packages("osmdata")
install.packages("wesanderson") 


# Load packages
library(sf)
library(tidyverse)
library(ggplot2)
library(rinat)
library(rosm)
library(ggspatial)
library(ggmap)
library(osmdata)
library(leaflet)
library(htmltools)
library(mapview)
library(leafpop)
library(wesanderson)
library(dplyr)
```

```{r}
# Read in the Marine Protected Areas dataset
mpa <- st_read("C:\\Users\\Win10\\Documents\\GIT\\Gracilaria\\Gracilaria\\data\\SAMPAZ_OR_2024_Q3.shp")
 
# Check the CRS
st_crs(mpa)

class(mpa)
head (mpa)

# Write data with sf
 st_write(mpa, "C:\\Users\\Win10\\Documents\\GIT\\Gracilaria\\Gracilaria\\data\\SAMPAZ_OR_2024_Q3_duplicate.shp", append = FALSE)
 
file.exists("C:\\Users\\Win10\\Documents\\GIT\\Gracilaria\\Gracilaria\\data\\SAMPAZ_OR_2024_Q3_duplicate.shp")
```

```{r}
# Plot all (all columns, all of SA)
plot(mpa)

# Plot only column 2 from attribute table, all of SA
 plot(mpa[2])

# Plot using tidyverse
ggplot() + geom_sf(data=mpa, aes(fill = `CUR_NME`))
```

```{r}
 # Define bounding box for the Cape Peninsula
xmin <- 18.0   # Extend west to include Robben Island
xmax <- 19.2   # Extend east to include parts of False Bay
ymin <- -34.6  # Extend south to cover more of False Bay
ymax <- -33.7  # Extend north to include Robben Island

# Create a bounding box with the same CRS as the MPA data
cape_bbox <- st_bbox(c(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax), crs = st_crs(mpa))
 
# Crop the MPA data to the Cape Peninsula region
mpa_cape <- st_crop(mpa, cape_bbox)

# Plot only cropped section of Cape Peninsula
plot(st_geometry(mpa_cape), col = 'lightblue', main = "Marine Protected Areas - Cape Peninsula")

#EVTL WEGLASSEN WEIL LABELS SICH ÃœBERSCHNEIDEN
# Add MPA names as labels
text(st_coordinates(st_centroid(mpa_cape)), labels = mpa_cape$CUR_NME, cex = 0.8, col = "black", pos = 4)

# Use ggplot for better visualisation
# Convert to data frame for ggplot2
mpa_cape_df <- as.data.frame(st_coordinates(st_centroid(mpa_cape)))  # Get centroids
mpa_cape_df$CUR_NME <- mpa_cape$CUR_NME  # Add names
# Plot with ggplot2
ggplot() +
  geom_sf(data = mpa_cape, fill = "lightblue", color = "darkblue") +
  geom_text(data = mpa_cape_df, aes(X, Y, label = CUR_NME), size = 3, color = "black") +
  ggtitle("Marine Protected Areas - Cape Peninsula") +
  theme_minimal()

# Create a plot using ggplot2 with a legend 

# Convert MPA data to a data frame for ggplot2
mpa_cape$MPA_Name <- as.factor(mpa_cape$CUR_NME)  # Convert MPAs to factor values

# Plot with ggplot2
ggplot() +
  geom_sf(data = mpa_cape, aes(fill = CUR_NME), color = "black") +  
  scale_fill_viridis_d(name = "MPA Name") +  
  ggtitle("Marine Protected Areas - Cape Peninsula") +
  theme_minimal() +
  theme(legend.position = "right")  

# Remove boundaries within MPAs
mpa_cape %>% group_by(CUR_NME) %>% 
  summarize() %>% 
  ggplot() + geom_sf(aes(fill = CUR_NME))
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
